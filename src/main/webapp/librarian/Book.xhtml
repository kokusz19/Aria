<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:of="http://omnifaces.org/functions">
  <h:head/>
  <h:body>
    <h:form rendered="#{pageHeaderController.actId != 1}">
      <f:view>
        <ui:include src="/PageHeader.xhtml"/>

        <p:dataTable var="book" value="#{bookController.books}" widgetVar="bookTable"
                     emptyMessage="No books found with given criteria"
                     filteredValue="#{bookController.filteredBooks}"
                     globalFilterFunction="#{bookController.globalFilterFunction}">
          <f:facet name="header">
            Books
            <div class="p-d-flex p-jc-end">
              <h:outputText value="Books"/>
              <p:inputText id="globalFilter" onkeyup="PF('bookTable').filter()" style="width:300px"
                           placeholder="Search all fields using global function" />
              <p:commandButton type="button" onclick="PF('dlg').show();" icon="pi pi-plus-circle"/>

              <p:dialog header="Add a book" widgetVar="dlg" modal="true">
                <h:outputText value="Title: "/>
                <p:inputText label="Title: " value="#{bookController.title}" /><br/>
                <h:outputText value="ISBN: "/>
                <p:inputText label="ISBN:" value="#{bookController.ISBN}" /><br/>
                <h:outputText value="Published at: "/>
                <p:datePicker label="Published at: " value="#{bookController.publishedAt}" /><br/>

                <h:outputText value="Max item: "/>
                <p:inputText label="Max item:: " value="#{bookController.maxItem}" /><br/>

                <p:selectCheckboxMenu title="Genre(s)" value="#{bookController.genres}" label="Genre(s)" style="min-width: 15rem"
                                      multiple="true" filter="true" filterMatchMode="startsWith" panelStyle="width: 30rem" scrollHeight="250">
                  <f:selectItems value="#{bookController.allGenres}"/>
                </p:selectCheckboxMenu><br/>

                <p:selectCheckboxMenu title="Author(s)" value="#{bookController.authors}" label="Author(s)" style="min-width: 15rem"
                                      multiple="true" filter="true" filterMatchMode="startsWith" panelStyle="width: 30rem" scrollHeight="250">
                  <f:selectItems value="#{bookController.allAuthors}"/>
                </p:selectCheckboxMenu><br/>

                <p:selectOneMenu value="#{bookController.language}" converter="omnifaces.SelectItemsConverter">
                  <f:selectItem itemValue="" itemLabel="Choose one" />
                  <f:selectItems value="#{bookController.allLanguages}" var="tmpLanguage" itemValue="#{tmpLanguage}" itemLabel="#{tmpLanguage.languageName}" />
                </p:selectOneMenu>

                <p:commandButton action="#{bookController.addBook}" value="Submit" onclick="PF('dlg').hide();"/>
              </p:dialog>
            </div>
          </f:facet>

          <p:column headerText="Book ID" filterable="false" width="5%" style="text-align: right">
            <h:outputText value="#{book.bookId}" />
          </p:column>
          <p:column headerText="Book name" filterable="false" style="text-align: left">
            <h:outputText value="#{book.bookTitle}" />
          </p:column>
          <p:column headerText="Author(s)" filterable="false" style="text-align: left">
            <h:outputText value="#{book.authorsString}" />
          </p:column>
          <p:column headerText="Genre(s)" filterable="false" style="text-align: left">
            <h:outputText value="#{book.genresString}" />
          </p:column>
          <p:column headerText="ISBN" filterable="false" style="text-align: left">
            <h:outputText value="#{book.isbn}" />
          </p:column>
          <p:column headerText="Published at" filterable="false" style="text-align: left">
            <h:outputText value="#{book.publishedAt}" />
          </p:column>
          <p:column headerText="Max items" filterable="false" style="text-align: left">
            <h:outputText value="#{book.maxItems}" />
          </p:column>
          <p:column headerText="Available items" filterable="false" style="text-align: left">
            <h:outputText value="#{book.availableItems}" />
          </p:column>
          <p:column headerText="Language" filterable="false" style="text-align: left">
            <h:outputText value="#{book.language.languageName}" />
          </p:column>


          <f:facet name="footer">
            <span class="p-text-bold">In total there are #{fn:length(bookController.books)} book(s).</span>
          </f:facet>
        </p:dataTable>
      </f:view>
    </h:form>
    <h:form rendered="#{pageHeaderController.actId == 1}">
      <h:outputLabel value="You do not have the right access!"/>
      <h:commandButton action="/user/HomePage.xhtml?faces-redirect=true" value="default page" rendered="#{pageHeaderController.actId == 1}"/>
    </h:form>
  </h:body>
</html>